カルマンフィルタは、状態推定やノイズのある観測データを基にシステムの内部状態を推定するために広く使用されるアルゴリズムです。以下は、カルマンフィルタで必要な基本的な数式を列挙します。

### 1. **システムモデル**

カルマンフィルタは、線形システムにおいて次の2つのモデルを前提としています。

#### a. **状態遷移モデル（State Transition Model）**
システムの次の状態は、現在の状態とコントロール入力（必要な場合）の線形関数です。状態方程式は次のように表されます。

\[
x_k = A x_{k-1} + B u_k + w_k
\]

- \( x_k \): 時刻 \(k\) における状態ベクトル
- \( A \): 状態遷移行列
- \( B \): コントロール入力行列
- \( u_k \): コントロール入力ベクトル
- \( w_k \): プロセスノイズ（通常は平均0のガウス分布で、共分散 \( Q \) を持つ）  
  \( w_k \sim N(0, Q) \)

#### b. **観測モデル（Measurement Model）**
システムの観測（測定値）は、状態の線形関数として得られます。

\[
z_k = H x_k + v_k
\]

- \( z_k \): 観測ベクトル
- \( H \): 観測行列
- \( v_k \): 観測ノイズ（通常は平均0のガウス分布で、共分散 \( R \) を持つ）  
  \( v_k \sim N(0, R) \)

### 2. **カルマンフィルタの手順**

カルマンフィルタは、予測（Prediction）と更新（Update）の2つのステップで実行されます。

#### a. **予測ステップ（Prediction Step）**

まず、システムの状態とその誤差共分散行列を時間更新します。

- **状態予測方程式**

\[
\hat{x}_k^- = A \hat{x}_{k-1} + B u_k
\]

  \(\hat{x}_k^-\): 時刻 \(k\) における事前状態推定（予測された状態）

- **誤差共分散行列の予測方程式**

\[
P_k^- = A P_{k-1} A^T + Q
\]

  \(P_k^-\): 時刻 \(k\) における事前誤差共分散行列（予測された共分散）

#### b. **更新ステップ（Update Step）**

予測された状態を観測データを用いて修正します。

- **カルマンゲインの計算**

\[
K_k = P_k^- H^T (H P_k^- H^T + R)^{-1}
\]

  \(K_k\): カルマンゲイン

- **状態更新方程式**

\[
\hat{x}_k = \hat{x}_k^- + K_k (z_k - H \hat{x}_k^-)
\]

  \(\hat{x}_k\): 修正後の状態推定

- **誤差共分散行列の更新方程式**

\[
P_k = (I - K_k H) P_k^-
\]

  \(P_k\): 修正後の誤差共分散行列

### 3. **初期条件**

カルマンフィルタを適用するためには、初期状態推定 \( \hat{x}_0 \) とその初期誤差共分散行列 \( P_0 \) を設定する必要があります。

---

これらの数式を順に使用して、システムの状態とその不確実性を反復的に推定していきます。カルマンフィルタはガウス分布を前提とした線形フィルタであり、状態推定に対して理論的に最適な結果を提供します。